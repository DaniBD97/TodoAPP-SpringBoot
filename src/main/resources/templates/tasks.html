<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Todo APP</title>

    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
            integrity="sha512-p1CmYlHgM+7cL4yEwR8Y/+D7fXQ2lWphxv6f+R4G1+Jf4KgR3+5U8wD3OztI1g3yU9T0ZtHxoC4zD1h3YXf+qA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <h1 class="mt-5 mx-auto text-center">Todo APP</h1>
    <div>
        <!-- Formulario para añadir nuevas tareas -->
        <form class="d-flex p-2 gap-2 align-items-center" action="/" method="post">
            <div>
                <input class="form-control form-control-lg" type="text" name="title" placeholder="Add a New Task" required>
            </div>
            <div>
                <button class="btn btn-success btn-lg" type="submit">Add</button>
            </div>
        </form>


        <div class="mt-4">
            <th:block th:each="task, iterStat : ${tasks}">
                <div class="card mb-2">
                    <div class="card-body">
                        <!-- Formulario para editar cada tarea -->
                        <form class="d-flex align-items-center" th:action="@{/{id}/edit(id=${task.id})}" method="post">


                            <input type="text" class="form-control" name="title" th:value="${task.title}" th:id="'task-input-' + ${iterStat.index}" required disabled>

                            <!-- Estado de la tarea  -->
                            <span class="mx-3 align-self-center" style="white-space: nowrap;" th:text="${task.completed} ? 'Completado' : 'Pendiente'"></span>

                            <!-- Contenedor para agrupar los botones de acción -->
                            <div class="btn-group ms-auto" role="group">

                                <button type="button" class="btn btn-outline-secondary" th:id="'edit-btn-' + ${iterStat.index}" th:onclick="habilitarEdicion([[${iterStat.index}]])">Editar</button>

                                <button type="submit" class="btn btn-outline-primary" th:id="'save-btn-' + ${iterStat.index}" style="display: none;">Guardar</button>

                                <a th:href="@{/{id}/toggle(id=${task.id})}" class="btn btn-outline-info">Toggle</a>
                                <a th:href="@{/{id}/delete(id=${task.id})}" class="btn btn-outline-danger">Delete</a>
                            </div>
                        </form>
                    </div>
                </div>
            </th:block>
        </div>
    </div>
</div>

<!-- integraremos javascript -->
<script>
    function habilitarEdicion(index) {
        // seleccionamos los botones y el input para realizar la funcion de habilitado/no habilitado

        const input = document.getElementById('task-input-' + index);
        const editButton = document.getElementById('edit-btn-' + index);
        const saveButton = document.getElementById('save-btn-' + index);

        // Habilitar el input
        input.disabled = false;
        input.focus();

        // toggle del boton para que aparezca el texto guardar cuando se aprete editar
        editButton.style.display = 'none';
        saveButton.style.display = 'inline-block';
    }
</script>

</body>
</html>